<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚˜ì˜ ë¡œë“œë§µ - ìŠ¤í…ì—…(Step-Up)</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .roadmap-content {
            background: var(--bg-light);
            min-height: calc(100vh - 60px);
            padding: 3rem 0;
        }

        .goal-overview {
            background: linear-gradient(135deg, var(--primary-color), #357ABD);
            color: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
        }

        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1.5rem;
        }

        .goal-info h2 {
            font-size: 1.75rem;
            margin-bottom: 0.5rem;
        }

        .goal-info p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .dday-badge {
            background: white;
            color: var(--danger-color);
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .progress-overview {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 2rem;
            align-items: center;
        }

        .circular-progress {
            position: relative;
        }

        .progress-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }

        .stat-item {
            text-align: center;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
        }

        .stat-text {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .content-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
        }

        .main-section {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .sidebar-section {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .section-card {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .today-tasks {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .task-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            background: var(--bg-light);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .task-item:hover {
            transform: translateX(4px);
            background: rgba(74, 144, 226, 0.1);
        }

        .task-item.completed {
            opacity: 0.6;
            text-decoration: line-through;
        }

        .task-checkbox {
            width: 24px;
            height: 24px;
            margin-right: 1rem;
            cursor: pointer;
        }

        .task-content {
            flex: 1;
        }

        .task-name {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.25rem;
        }

        .task-due {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .calendar-view {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
        }

        .calendar-header {
            text-align: center;
            font-weight: 600;
            padding: 0.5rem;
            color: var(--text-dark);
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: var(--bg-light);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            padding: 0.5rem;
            font-size: 0.85rem;
        }

        .calendar-day:hover {
            background: rgba(74, 144, 226, 0.1);
        }

        .calendar-day.has-task {
            background: var(--primary-color);
            color: white;
        }

        .calendar-day.today {
            border: 2px solid var(--primary-color);
        }

        .day-number {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .task-count {
            font-size: 0.7rem;
            opacity: 0.8;
        }

        .timeline {
            position: relative;
            padding-left: 2rem;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--border-color);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 2rem;
            padding-left: 1.5rem;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -2rem;
            top: 0.25rem;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--primary-color);
            border: 3px solid white;
            box-shadow: 0 0 0 2px var(--primary-color);
        }

        .timeline-item.completed::before {
            background: var(--secondary-color);
            box-shadow: 0 0 0 2px var(--secondary-color);
        }

        .timeline-date {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-bottom: 0.5rem;
        }

        .timeline-content {
            background: var(--bg-light);
            padding: 1rem;
            border-radius: 8px;
        }

        .timeline-title {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.25rem;
        }

        .timeline-description {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .quick-actions {
            display: grid;
            gap: 0.75rem;
        }

        .action-btn {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem;
            background: var(--bg-light);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
            font-size: 0.95rem;
        }

        .action-btn:hover {
            background: rgba(74, 144, 226, 0.1);
            transform: translateX(4px);
        }

        .action-icon {
            font-size: 1.5rem;
        }

        @media (max-width: 1024px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
            
            .progress-overview {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
    <nav class="navbar">
        <div class="container">
            <a href="roadmap.html" class="logo">ğŸ¯ ìŠ¤í…ì—…</a>
            <ul class="nav-links">
                <li><a href="roadmap.html">ë¡œë“œë§µ</a></li>
                <li><a href="dashboard.html">ë‚´ ìŠ¤í™</a></li>
                <li><a href="goal-setting.html">ëª©í‘œ ì„¤ì •</a></li>
                <li><a href="#" onclick="logout(); return false;">ë¡œê·¸ì•„ì›ƒ</a></li>
            </ul>
        </div>
    </nav>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <div class="roadmap-content">
        <div class="container">
            <!-- ëª©í‘œ ê°œìš” -->
            <div class="goal-overview" id="goalOverview">
                <div class="goal-header">
                    <div class="goal-info">
                        <h2 id="goalTitle">ëª©í‘œë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”</h2>
                        <p id="goalCompany">ëª©í‘œ ì„¤ì • í˜ì´ì§€ì—ì„œ ì›í•˜ëŠ” ì±„ìš© ê³µê³ ë¥¼ ì„ íƒí•˜ì„¸ìš”</p>
                    </div>
                    <div class="dday-badge" id="ddayBadge">-</div>
                </div>
                
                <div class="progress-overview">
                    <div class="circular-progress">
                        <canvas id="progressChart" width="250" height="250"></canvas>
                    </div>
                    <div class="progress-stats">
                        <div class="stat-item">
                            <div class="stat-number" id="totalTasks">0</div>
                            <div class="stat-text">ì „ì²´ ì—…ë¬´</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="completedTasks">0</div>
                            <div class="stat-text">ì™„ë£Œ</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="remainingTasks">0</div>
                            <div class="stat-text">ë‚¨ì€ ì—…ë¬´</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì»¨í…ì¸  ê·¸ë¦¬ë“œ -->
            <div class="content-grid">
                <!-- ë©”ì¸ ì„¹ì…˜ -->
                <div class="main-section">
                    <!-- ì˜¤ëŠ˜ì˜ í•  ì¼ -->
                    <div class="section-card">
                        <div class="section-header">
                            <h2 class="card-title">ğŸ“ ì˜¤ëŠ˜ì˜ í•  ì¼</h2>
                            <span class="badge badge-info" id="todayTaskCount">0ê°œ</span>
                        </div>
                        <div class="today-tasks" id="todayTaskList">
                            <div class="empty-state">
                                <p>ì˜¤ëŠ˜ í•  ì¼ì´ ì—†ìŠµë‹ˆë‹¤</p>
                            </div>
                        </div>
                    </div>

                    <!-- ì „ì²´ ì—…ë¬´ íƒ€ì„ë¼ì¸ -->
                    <div class="section-card">
                        <div class="section-header">
                            <h2 class="card-title">ğŸ“… ì „ì²´ ì—…ë¬´ íƒ€ì„ë¼ì¸</h2>
                        </div>
                        <div class="timeline" id="taskTimeline">
                            <div class="empty-state">
                                <p>ë“±ë¡ëœ ì—…ë¬´ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ì‚¬ì´ë“œë°” -->
                <div class="sidebar-section">
                    <!-- ìº˜ë¦°ë” -->
                    <div class="section-card">
                        <h3 class="card-title">ğŸ“† ìº˜ë¦°ë”</h3>
                        <div id="miniCalendar"></div>
                    </div>

                    <!-- ë¹ ë¥¸ ì‹¤í–‰ -->
                    <div class="section-card">
                        <h3 class="card-title">âš¡ ë¹ ë¥¸ ì‹¤í–‰</h3>
                        <div class="quick-actions">
                            <button class="action-btn" onclick="window.location.href='goal-setting.html'">
                                <span class="action-icon">ğŸ¯</span>
                                <span>ëª©í‘œ ë³€ê²½í•˜ê¸°</span>
                            </button>
                            <button class="action-btn" onclick="window.location.href='dashboard.html'">
                                <span class="action-icon">ğŸ“Š</span>
                                <span>ë‚´ ìŠ¤í™ ë³´ê¸°</span>
                            </button>
                            <button class="action-btn" onclick="addNewTask()">
                                <span class="action-icon">â•</span>
                                <span>ìƒˆ ì—…ë¬´ ì¶”ê°€</span>
                            </button>
                            <button class="action-btn" onclick="exportProgress()">
                                <span class="action-icon">ğŸ“¥</span>
                                <span>ì§„í–‰ìƒí™© ë‚´ë³´ë‚´ê¸°</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        // ë°ì´í„° ë¡œë“œ
        const goalData = StorageManager.getGoal();
        let tasks = StorageManager.getTasks();

        if (goalData && goalData.job) {
            displayGoal(goalData);
            displayTasks(tasks);
            updateProgress();
            renderCalendar();
        } else {
            // ëª©í‘œê°€ ì—†ìœ¼ë©´ ì•ˆë‚´ ë©”ì‹œì§€
            document.getElementById('todayTaskList').innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">ğŸ¯</div>
                    <p>ë¨¼ì € ëª©í‘œë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”</p>
                    <a href="goal-setting.html" class="btn btn-primary mt-1">ëª©í‘œ ì„¤ì •í•˜ê¸°</a>
                </div>
            `;
        }

        function displayGoal(data) {
            document.getElementById('goalTitle').textContent = data.job.title;
            document.getElementById('goalCompany').textContent = data.job.company + ' Â· ' + data.job.location;
            document.getElementById('ddayBadge').textContent = calculateDday(data.job.deadline);
        }

        function displayTasks(taskList) {
            if (!taskList || taskList.length === 0) return;

            const today = new Date().toISOString().split('T')[0];
            const todayTasks = taskList.filter(task => task.dueDate === today || !task.completed);

            // ì˜¤ëŠ˜ì˜ í•  ì¼
            const todayTaskListEl = document.getElementById('todayTaskList');
            document.getElementById('todayTaskCount').textContent = todayTasks.filter(t => !t.completed).length + 'ê°œ';
            
            if (todayTasks.length > 0) {
                todayTaskListEl.innerHTML = todayTasks.map(task => `
                    <div class="task-item ${task.completed ? 'completed' : ''}" onclick="toggleTask(${task.id})">
                        <input type="checkbox" class="task-checkbox" ${task.completed ? 'checked' : ''} onclick="event.stopPropagation(); toggleTask(${task.id})">
                        <div class="task-content">
                            <div class="task-name">${task.title}</div>
                            <div class="task-due">ë§ˆê°: ${task.dueDate}</div>
                        </div>
                    </div>
                `).join('');
            }

            // ì „ì²´ íƒ€ì„ë¼ì¸
            const timelineEl = document.getElementById('taskTimeline');
            timelineEl.innerHTML = taskList.map(task => `
                <div class="timeline-item ${task.completed ? 'completed' : ''}">
                    <div class="timeline-date">${task.dueDate}</div>
                    <div class="timeline-content">
                        <div class="timeline-title">${task.title}</div>
                        <div class="timeline-description">
                            ${task.completed ? 'âœ… ì™„ë£Œë¨' : 'â³ ì§„í–‰ ì¤‘'}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function toggleTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                task.completed = !task.completed;
                StorageManager.saveTasks(tasks);
                displayTasks(tasks);
                updateProgress();
            }
        }

        function updateProgress() {
            if (!tasks || tasks.length === 0) {
                drawCircularProgress('progressChart', 0);
                return;
            }

            const total = tasks.length;
            const completed = tasks.filter(t => t.completed).length;
            const remaining = total - completed;
            const percentage = Math.round((completed / total) * 100);

            document.getElementById('totalTasks').textContent = total;
            document.getElementById('completedTasks').textContent = completed;
            document.getElementById('remainingTasks').textContent = remaining;

            drawCircularProgress('progressChart', percentage);
        }

        function renderCalendar() {
            const calendar = document.getElementById('miniCalendar');
            const today = new Date();
            const year = today.getFullYear();
            const month = today.getMonth();

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            const weekdays = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            let html = '';

            // ìš”ì¼ í—¤ë”
            weekdays.forEach(day => {
                html += `<div class="calendar-header">${day}</div>`;
            });

            // ë¹ˆ ì¹¸
            for (let i = 0; i < firstDay; i++) {
                html += '<div class="calendar-day"></div>';
            }

            // ë‚ ì§œ
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dateStr = date.toISOString().split('T')[0];
                const isToday = day === today.getDate();
                const tasksOnDay = tasks?.filter(t => t.dueDate === dateStr).length || 0;

                html += `
                    <div class="calendar-day ${isToday ? 'today' : ''} ${tasksOnDay > 0 ? 'has-task' : ''}">
                        <div class="day-number">${day}</div>
                        ${tasksOnDay > 0 ? `<div class="task-count">${tasksOnDay}ê°œ</div>` : ''}
                    </div>
                `;
            }

            calendar.innerHTML = '<div class="calendar-view">' + html + '</div>';
        }

        function addNewTask() {
            const title = prompt('ìƒˆ ì—…ë¬´ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”:');
            if (!title) return;

            const dueDate = prompt('ë§ˆê°ì¼ì„ ì…ë ¥í•˜ì„¸ìš” (YYYY-MM-DD):');
            if (!dueDate) return;

            const newTask = {
                id: tasks.length > 0 ? Math.max(...tasks.map(t => t.id)) + 1 : 1,
                title: title,
                completed: false,
                dueDate: dueDate
            };

            tasks.push(newTask);
            StorageManager.saveTasks(tasks);
            displayTasks(tasks);
            updateProgress();
            renderCalendar();
            
            alert('ìƒˆ ì—…ë¬´ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        function exportProgress() {
            const data = {
                goal: goalData,
                tasks: tasks,
                exportDate: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `stepup-progress-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
